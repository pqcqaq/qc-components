{"version":3,"file":"ManagePage.vue_vue_type_script_setup_true_lang-DtgwUDek.js","sources":["../../../../qc-components/dynamic-form/index.js","../../../../qc-components/manage-page/ManagePage.vue"],"sourcesContent":["import \"./assets/css/base.scss\";\nexport * from './types';\n// import type { App } from 'vue'\nimport DynamicForm from \"./DynamicForm.vue\";\nexport { useFullScreenDyForm } from \"./hooks/useFullScreenDyForm\";\n// 使用install方法，在app.use挂载\nDynamicForm.install = function (Vue) {\n    Vue.component(DynamicForm.name || \"\", DynamicForm);\n};\nexport default DynamicForm;\n//# sourceMappingURL=index.js.map","<template>\n\t<div>\n\t\t<template v-if=\"props.schema.title !== undefined\">\n\t\t\t<template v-if=\"typeof props.schema.title === 'string'\">\n\t\t\t\t<div class=\"title\">\n\t\t\t\t\t{{ props.schema.title || \"\" }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"title\"\n\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t...props.schema.title.style,\n\t\t\t\t\t}\"\n\t\t\t\t>\n\t\t\t\t\t{{ props.schema.title.text || \"\" }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</template>\n\t\t<div\n\t\t\tclass=\"seacher\"\n\t\t\t:style=\"{\n\t\t\t\t...props.schema.seacher.style,\n\t\t\t}\"\n\t\t>\n\t\t\t<DynamicForm\n\t\t\t\tclass=\"seacher-form\"\n\t\t\t\t:schema=\"formSchema\"\n\t\t\t\tv-model=\"searchModel\"\n\t\t\t\t:disabled=\"disabled\"\n\t\t\t/>\n\t\t</div>\n\t\t<template v-if=\"props.schema.handleAdd !== undefined\">\n\t\t\t<div\n\t\t\t\t:style=\"{\n\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t...props.schema.handleAdd.outerStyle,\n\t\t\t\t}\"\n\t\t\t\tclass=\"btns\"\n\t\t\t>\n\t\t\t\t<a-button\n\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t'margin-left': 'auto',\n\t\t\t\t\t\t'margin-top': '10px',\n\t\t\t\t\t\t'margin-right': '10px',\n\t\t\t\t\t\t'margin-bottom': '10px',\n\t\t\t\t\t\t...props.schema.handleAdd.btnStyle,\n\t\t\t\t\t}\"\n\t\t\t\t\tv-bind=\"props.schema.handleAdd.btnProps\"\n\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t@click=\"handleAdd\"\n\t\t\t\t>\n\t\t\t\t\t新增\n\t\t\t\t</a-button>\n\t\t\t</div>\n\t\t</template>\n\t\t<div\n\t\t\tclass=\"list\"\n\t\t\t:style=\"{\n\t\t\t\t...props.schema.table.style,\n\t\t\t}\"\n\t\t>\n\t\t\t<EasyTable\n\t\t\t\tclass=\"list-table\"\n\t\t\t\t:data=\"data\"\n\t\t\t\t:schema=\"tableSchema\"\n\t\t\t\t:enable-deep-clone=\"enableDeepClone\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n</template>\n\n<script lang=\"ts\">\nexport default {\n\tname: \"manage-page\",\n};\n</script>\n\n<script setup lang=\"ts\">\nimport { DyForm } from \"../dynamic-form/types\";\nimport { defineAsyncComponent, ref, reactive } from \"vue\";\nimport { TableSchema } from \"../types\";\nimport { ManagePageSchema } from \"./types\";\nimport { message } from \"ant-design-vue\";\nimport { useFullScreenDyForm } from \"../dynamic-form\";\nconst DynamicForm = defineAsyncComponent(\n\t() => import(\"../dynamic-form/DynamicForm.vue\")\n);\nconst EasyTable = defineAsyncComponent(\n\t() => import(\"../easy-table/EasyTable.vue\")\n);\nconst TableButtons = defineAsyncComponent(\n\t() => import(\"../easy-table/components/TableButtons.vue\")\n);\n\ntype PropType = {\n\tschema: ManagePageSchema;\n\tenableDeepClone?: boolean;\n};\n\nconst props = defineProps<PropType>();\n\nconst disabled = ref<boolean>(false);\nconst formSchema: DyForm = reactive<DyForm>({\n\tformProps: {\n\t\t// 布局：水平布局\n\t\tlayout: \"inline\",\n\t},\n\tcustomBtns: [\n\t\t{\n\t\t\ttext: \"搜索\",\n\t\t\tprops: {\n\t\t\t\ttype: \"primary\",\n\t\t\t},\n\t\t\tonClick: async ({ doCheck, model, event }) => {\n\t\t\t\tconst result = (await doCheck?.()) || false;\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tawait doSearch();\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttext: \"重置\",\n\t\t\tonClick: async () => {\n\t\t\t\tawait doReset();\n\t\t\t},\n\t\t},\n\t],\n\t// schema\n\titems: props.schema.seacher.items || [],\n});\nconst searchModel = ref<Record<string, any>>({});\nconst doReset = async () => {\n\tsearchModel.value = {};\n\tawait fetchData();\n};\nconst doSearch = async () => {\n\tawait fetchData();\n};\n\nconst tableSchema: TableSchema = reactive({\n\tprops: {},\n\t// schema\n\tcolumns: [...props.schema.table.columns],\n});\n\n// 单独配置props，因为类型实例化过深，会导致无法正确推导类型\ntableSchema.props = {\n\tpagination: {\n\t\tcurrent: 1,\n\t},\n\t...props.schema.table.props,\n\tloading: false,\n\tonChange: (pagination, filters, sorter, extra) => {\n\t\ttableSchema.props!.pagination = pagination;\n\t\tfetchData();\n\t},\n};\n\nif (\n\tprops.schema.handleDelete !== undefined ||\n\tprops.schema.handleEdit !== undefined\n) {\n\tconst getBtns = (record: Record<string, any> | undefined) => {\n\t\tconst btns = [];\n\t\tif (props.schema.handleEdit !== undefined) {\n\t\t\tbtns.push({\n\t\t\t\ttext: props.schema.handleEdit!.text || \"编辑\",\n\t\t\t\tonClick: () => {\n\t\t\t\t\thandleEdit(record);\n\t\t\t\t},\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"primary\",\n\t\t\t\t\tsize: \"small\",\n\t\t\t\t\t...props.schema.handleEdit!.btnProps,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tif (props.schema.handleDelete !== undefined) {\n\t\t\tbtns.push({\n\t\t\t\ttext: props.schema.handleDelete!.text || \"删除\",\n\t\t\t\tonClick: async () => {\n\t\t\t\t\tawait props.schema.handleDelete!.deleteData?.({\n\t\t\t\t\t\trecord: {\n\t\t\t\t\t\t\t...record,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdoRefresh: fetchData,\n\t\t\t\t\t\tdoSearch,\n\t\t\t\t\t\tdoReset,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprops: {\n\t\t\t\t\ttype: \"primary\",\n\t\t\t\t\tsize: \"small\",\n\t\t\t\t\tdanger: true,\n\t\t\t\t\t...props.schema.handleDelete!.btnProps,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t};\n\ttableSchema.columns.push({\n\t\theader: \"管理\",\n\t\tbody: {\n\t\t\tindex: \"action\",\n\t\t\trender: ({ text, record, index }) => {\n\t\t\t\treturn {\n\t\t\t\t\tcomponent: TableButtons,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tbtns: getBtns(record),\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t},\n\t});\n}\n\nconst data = ref<any[]>([]);\n\nconst handleEdit = async (record: any) => {\n\tuseFullScreenDyForm({\n\t\tshowBtns: {\n\t\t\tsubmit: 1,\n\t\t\treset: 1,\n\t\t\tclearAll: 1,\n\t\t},\n\t\t...(props.schema.handleEdit?.editor as any),\n\t\tdefaultValues: {\n\t\t\t...record,\n\t\t},\n\t\tsubmit: async (values, close) => {\n\t\t\tawait props.schema.handleEdit?.editData?.({\n\t\t\t\trecord: {\n\t\t\t\t\t...record,\n\t\t\t\t\t...values,\n\t\t\t\t},\n\t\t\t\tdoRefresh: fetchData,\n\t\t\t\tdoSearch,\n\t\t\t\tdoReset,\n\t\t\t\tclose: close as () => void,\n\t\t\t});\n\t\t},\n\t});\n};\n\nconst fetchData = async () => {\n\ttableSchema.props!.loading = true;\n\tdisabled.value = true;\n\ttry {\n\t\tconst result = await props.schema.fetchData({\n\t\t\tpaginator: {\n\t\t\t\tpageSize: tableSchema.props!.pagination\n\t\t\t\t\t? tableSchema.props!.pagination.pageSize\n\t\t\t\t\t: 10,\n\t\t\t\tcurrent: tableSchema.props!.pagination\n\t\t\t\t\t? tableSchema.props!.pagination.current\n\t\t\t\t\t: 1,\n\t\t\t},\n\t\t\tmodel: {\n\t\t\t\t...searchModel.value,\n\t\t\t},\n\t\t});\n\t\tdata.value = result.data;\n\t\ttableSchema.props!.pagination = {\n\t\t\t...tableSchema.props!.pagination,\n\t\t\ttotal: result.total,\n\t\t\tcurrent: result.current,\n\t\t};\n\t} catch (error) {\n\t\tmessage.error(\"获取数据失败\");\n\t} finally {\n\t\ttableSchema.props!.loading = false;\n\t\tdisabled.value = false;\n\t}\n};\n\nfetchData();\n\nconst handleAdd = async () => {\n\tuseFullScreenDyForm({\n\t\tshowBtns: {\n\t\t\tsubmit: 1,\n\t\t\treset: 1,\n\t\t\tclearAll: 1,\n\t\t},\n\t\t...(props.schema.handleAdd?.creator as any),\n\t\tinit: {},\n\t\tsubmit: async (values, close) => {\n\t\t\tawait props.schema.handleAdd?.addData?.({\n\t\t\t\trecord: {\n\t\t\t\t\t...values,\n\t\t\t\t},\n\t\t\t\tdoRefresh: fetchData,\n\t\t\t\tdoSearch,\n\t\t\t\tdoReset,\n\t\t\t\tclose: close as () => void,\n\t\t\t});\n\t\t},\n\t});\n};\n</script>\n"],"names":["DynamicForm","Vue","__default__","defineAsyncComponent","EasyTable","TableButtons","props","__props","disabled","ref","formSchema","reactive","doCheck","model","event","doSearch","doReset","searchModel","fetchData","tableSchema","pagination","filters","sorter","extra","getBtns","record","btns","handleEdit","_b","_a","text","index","data","useFullScreenDyForm","values","close","result","message","handleAdd"],"mappings":"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"}
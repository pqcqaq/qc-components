{"version":3,"file":"FullScreenDyForm-CbQUltAv.js","sources":["../../../../qc-components/dynamic-form/components/FullScreenDyForm.vue"],"sourcesContent":["<template>\n\t<div\n\t\tclass=\"fullscreen\"\n\t\tv-fade-in-out=\"{\n\t\t\tfadeTime: props.fadeTime || 150,\n\t\t\tenable: props.fadeInOut || true,\n\t\t}\"\n\t\t@click=\"\n\t\t\tprops.onModalClick?.({\n\t\t\t\tmodel: formModel,\n\t\t\t\tclose: () => props.onCancel(),\n\t\t\t\tevent: $event,\n\t\t\t})\n\t\t\"\n\t>\n\t\t<div\n\t\t\tclass=\"full-form\"\n\t\t\tv-move\n\t\t\tv-scale-in=\"{\n\t\t\t\tfadeTime: props.fadeTime || 150,\n\t\t\t\tenable: props.fadeInOut || true,\n\t\t\t}\"\n\t\t\t:style=\"{\n\t\t\t\t...props.style,\n\t\t\t}\"\n\t\t\t@click.stop\n\t\t>\n\t\t\t<DynamicForm\n\t\t\t\t:schema=\"schema\"\n\t\t\t\tv-model=\"formModel\"\n\t\t\t\t:show-btns=\"props.showBtns\"\n\t\t\t\tclass=\"form\"\n\t\t\t\t:on-before-submit=\"handleOnBeforeSubmit\"\n\t\t\t\t:on-submit=\"props.onSubmit\"\n\t\t\t\t:on-after-submit=\"handleOnAfterSubmit\"\n\t\t\t\t:registe-to-parent=\"register\"\n\t\t\t/>\n\t\t\t<div class=\"btns\" v-if=\"!!props.showCloseBtn\">\n\t\t\t\t<a-button\n\t\t\t\t\tshape=\"circle\"\n\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\tdanger\n\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t\t:disabled=\"isLoading\"\n\t\t\t\t>\n\t\t\t\t\t<CloseOutlined\n\t\t\t\t/></a-button>\n\t\t\t</div>\n\t\t\t<!-- 自定义按钮显示在下面，横向排列居中 -->\n\t\t\t<div\n\t\t\t\tv-if=\"props.customBtns && props.customBtns.length > 0\"\n\t\t\t\tclass=\"custombtns\"\n\t\t\t\t:style=\"{\n\t\t\t\t\t...{\n\t\t\t\t\t\tdisplay: 'flex',\n\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\tmarginTop: '20px',\n\t\t\t\t\t\tgap: '20px',\n\t\t\t\t\t},\n\t\t\t\t\t...schema.customBtnsStyle,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"btn in props.customBtns\"\n\t\t\t\t\t:key=\"btn.text\"\n\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t...{\n\t\t\t\t\t\t\tdisplay: 'inline',\n\t\t\t\t\t\t\tjustifyContent: 'center',\n\t\t\t\t\t\t},\n\t\t\t\t\t\t...btn.outterStyle,\n\t\t\t\t\t}\"\n\t\t\t\t>\n\t\t\t\t\t<a-button\n\t\t\t\t\t\t@click=\"\n\t\t\t\t\t\t\t($event) => {\n\t\t\t\t\t\t\t\tbtn.onClick?.({\n\t\t\t\t\t\t\t\t\tdoCheck: () => checker(),\n\t\t\t\t\t\t\t\t\tclose: () => props.onCancel(),\n\t\t\t\t\t\t\t\t\tmodel: formModel,\n\t\t\t\t\t\t\t\t\tevent: $event,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\"\n\t\t\t\t\t\tv-bind=\"btn.props\"\n\t\t\t\t\t\t:style=\"{\n\t\t\t\t\t\t\t...btn.style,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ btn.text }}\n\t\t\t\t\t</a-button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n\tCSSProperties,\n\tDirective,\n\tRef,\n\tonMounted,\n\tref,\n\twatch,\n\tdefineAsyncComponent,\n\tComponentInternalInstance,\n} from \"vue\";\nimport type { DyForm, FuncCustomBtn, ModalClickFn } from \"../types\";\nimport DynamicForm from \"../DynamicForm.vue\";\nimport { Modal } from \"ant-design-vue\";\nimport { CloseOutlined } from \"@ant-design/icons-vue\";\n\nconst AButton = defineAsyncComponent(() => import(\"ant-design-vue/es/button\"));\n\nconst nextFormRefs = ref<ComponentInternalInstance>();\n\nconst register = (form: ComponentInternalInstance) => {\n\tnextFormRefs.value = form;\n};\n\ntype MousePosition = { x: number; y: number } | null;\n\ntype propType = {\n\tschema: DyForm;\n\tshowBtns:\n\t\t| {\n\t\t\t\tclearAll: 0 | 1;\n\t\t\t\treset: 0 | 1;\n\t\t\t\tsubmit: 0 | 1;\n\t\t  }\n\t\t| boolean;\n\tinit: Record<string, any>;\n\tonCancel: () => void;\n\tallowDirectClose: boolean;\n\tonSubmit?: (formData: Record<string, any>) => void;\n\tstyle: CSSProperties;\n\tdraggable?: boolean;\n\ttitle?: string;\n\tfadeInOut?: boolean;\n\tfadeTime?: number;\n\tmousePosition: MousePosition;\n\tgoClose: Ref<boolean>;\n\tcustomBtns?: FuncCustomBtn[];\n\tshowCloseBtn?: boolean;\n\tonModalClick?: ModalClickFn;\n};\n\nconst props = defineProps<propType>();\nconst formModel = ref<Record<string, any>>({});\nconst isLoading = ref(false);\nconst schema = ref<DyForm>(props.schema) as Ref<DyForm>;\n\nonMounted(() => {\n\tif (Object.keys(props.init).length > 0) {\n\t\tformModel.value = { ...props.init };\n\t}\n\tif (props.title) {\n\t\tschema.value.title = props.title;\n\t}\n});\n\nconst handleClose = () => {\n\tif (props.allowDirectClose) {\n\t\tprops.onCancel();\n\t} else {\n\t\t// 确认框\n\t\tModal.confirm({\n\t\t\ttitle: \"确认关闭\",\n\t\t\tcontent: \"关闭后将不会保存当前数据，是否继续？\",\n\t\t\tonOk: () => {\n\t\t\t\tprops.onCancel();\n\t\t\t},\n\t\t\tokText: \"确认关闭\",\n\t\t\tokType: \"primary\",\n\t\t\tokButtonProps: { danger: true },\n\t\t\tcancelText: \"返回\",\n\t\t\tzIndex: 10000,\n\t\t\tcentered: true,\n\t\t});\n\t}\n};\n\nconst handleOnBeforeSubmit = () => {\n\tisLoading.value = true;\n};\n\nconst handleOnAfterSubmit = () => {\n\tisLoading.value = false;\n};\n\nconst vMove: Directive = {\n\tmounted(el: HTMLElement) {\n\t\tif (!props.draggable) {\n\t\t\treturn;\n\t\t}\n\t\tlet moveEl = el as HTMLElement;\n\t\tconst mouseDown = (e: MouseEvent) => {\n\t\t\tconst elNowPos = {\n\t\t\t\tx: moveEl.getBoundingClientRect().x,\n\t\t\t\ty: moveEl.getBoundingClientRect().y,\n\t\t\t};\n\t\t\tconst mouseBefore: { x: number; y: number } = {\n\t\t\t\tx: e.clientX,\n\t\t\t\ty: e.clientY,\n\t\t\t};\n\t\t\tconst elShape = {\n\t\t\t\twidth: moveEl.getBoundingClientRect().width,\n\t\t\t\theight: moveEl.getBoundingClientRect().height,\n\t\t\t};\n\t\t\tconst move = (e: MouseEvent) => {\n\t\t\t\t// 设置鼠标样式\n\t\t\t\tmoveEl.style.cursor = \"move\";\n\t\t\t\tconst mouseMove: { x: number; y: number } = {\n\t\t\t\t\tx: e.clientX - mouseBefore.x,\n\t\t\t\t\ty: e.clientY - mouseBefore.y,\n\t\t\t\t};\n\t\t\t\tconst offset = {\n\t\t\t\t\tx: elNowPos.x + mouseMove.x,\n\t\t\t\t\ty: elNowPos.y + mouseMove.y,\n\t\t\t\t};\n\t\t\t\t// 判断是否超出边界\n\t\t\t\tif (offset.x < 15 || offset.y < 15) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 判断右下边界\n\t\t\t\tif (\n\t\t\t\t\toffset.x + elShape.width > window.innerWidth - 30 ||\n\t\t\t\t\toffset.y + elShape.height > window.innerHeight - 15\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// 更新拖拽元素的位置\n\t\t\t\tmoveEl.style.left = offset.x + \"px\";\n\t\t\t\tmoveEl.style.top = offset.y + \"px\";\n\t\t\t};\n\t\t\tdocument.addEventListener(\"mousemove\", move);\n\t\t\tdocument.addEventListener(\"mouseup\", () => {\n\t\t\t\t// 取消鼠标样式\n\t\t\t\tmoveEl.style.cursor = \"default\";\n\t\t\t\tdocument.removeEventListener(\"mousemove\", move);\n\t\t\t});\n\t\t};\n\n\t\tmoveEl.style.position = \"absolute\"; // 确保拖拽元素的定位方式为绝对定位\n\t\tmoveEl.addEventListener(\"mousedown\", mouseDown);\n\t},\n\t// 取消挂载时注销事件\n\tunmounted(el: HTMLElement) {\n\t\tif (!props.draggable) {\n\t\t\treturn;\n\t\t}\n\t\tlet moveEl = el as HTMLElement;\n\t\tmoveEl.removeEventListener(\"mousedown\", () => {});\n\t},\n};\n\ntype FadeType = {\n\tfadeTime: number;\n\tenable: boolean;\n};\n\nlet fadeElement: HTMLElement | null = null;\n\nconst vFadeInOut: Directive = {\n\tmounted(el: HTMLElement, binding) {\n\t\t// 保存元素\n\t\tfadeElement = el;\n\t\tconst config = binding.value as FadeType;\n\t\tif (!config.enable) {\n\t\t\treturn;\n\t\t}\n\t\tel.style.opacity = \"0\"; // 初始状态设置为透明\n\t\t// 设置所有动画都在下一个事件循环中执行\n\t\tsetTimeout(() => {\n\t\t\tel.style.transition = \"opacity \" + config.fadeTime + \"ms ease\";\n\t\t\tel.style.opacity = \"1\"; // 淡入\n\t\t}, 10);\n\t},\n};\n\nlet scaleElement: HTMLElement | null = null;\nconst vScaleIn: Directive = {\n\tmounted(el: HTMLElement, binding) {\n\t\t// 保存元素\n\t\tscaleElement = el;\n\t\tconst config = binding.value as FadeType;\n\t\tif (!config.enable) {\n\t\t\treturn;\n\t\t}\n\t\t// 设置初始缩放比例\n\t\tel.style.scale = \"0.2\";\n\t\tif (!props.mousePosition) {\n\t\t\t// 设置缩放中心在自己中心\n\t\t\tel.style.transformOrigin = \"center\";\n\t\t\treturn;\n\t\t}\n\t\t// 获取元素的位置信息\n\t\tconst rect = el.getBoundingClientRect();\n\t\t// 计算鼠标点击位置相对于元素位置的偏移量\n\t\tconst offsetX = props.mousePosition.x - rect.left;\n\t\tconst offsetY = props.mousePosition.y - rect.top;\n\t\t// 设置缩放中心为鼠标点击位置\n\t\tel.style.transformOrigin = `${offsetX}px ${offsetY}px`;\n\t\t// 设置所有动画都在下一个事件循环中执行\n\t\tsetTimeout(() => {\n\t\t\tel.style.transition = \"scale \" + config.fadeTime + \"ms ease\";\n\t\t\tel.style.scale = \"1\";\n\t\t});\n\t},\n};\n\nwatch(\n\t() => props.goClose.value,\n\t(val) => {\n\t\tif (val) {\n\t\t\t// 设置元素淡出和缩放\n\t\t\tif (fadeElement) {\n\t\t\t\tfadeElement.style.opacity = \"0\";\n\t\t\t}\n\t\t\tif (scaleElement) {\n\t\t\t\tscaleElement.style.scale = \"0.2\";\n\t\t\t}\n\t\t}\n\t}\n);\n\nconst checker = async () => {\n\treturn (\n\t\t!!(await nextFormRefs.value?.exposed?.validateThenGetModel()) || false\n\t);\n};\n</script>\n<style scoped lang=\"scss\">\n.fullscreen {\n\tposition: fixed;\n\tz-index: 1000;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tflex-direction: column;\n\tdisplay: flex;\n\t.full-form {\n\t\toverflow-y: auto;\n\t\toverflow-x: hidden;\n\t\tbackground-color: #fff;\n\t\tpadding: 20px;\n\t\tborder-radius: 15px;\n\t\tborder: 1px solid #ccc;\n\t\tbox-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n\t\tdisplay: inline-block;\n\t\tmax-width: 80%;\n\t\tmax-height: 90%;\n\t\tposition: relative;\n\t\t.form {\n\t\t\twidth: 100%;\n\t\t}\n\t\t.btns {\n\t\t\tposition: absolute;\n\t\t\ttop: 10px;\n\t\t\tright: 12px;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t\tflex-direction: row-reverse;\n\t\t\tgap: 10px;\n\t\t}\n\t}\n}\n/*定义滚动条高宽及背景\n 高宽分别对应横竖滚动条的尺寸*/\n::-webkit-scrollbar {\n\twidth: 10px;\n\tbackground-color: #f5f5f5;\n\tborder-radius: 5px;\n}\n/*定义滚动条轨道\n 内阴影+圆角*/\n::-webkit-scrollbar-track {\n\t-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n\tborder-radius: 10px;\n\tbackground-color: #f5f5f5;\n}\n/*定义滑块\n 内阴影+圆角*/\n::-webkit-scrollbar-thumb {\n\tborder-radius: 10px;\n\t-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\n\tbackground-color: #9a9a9a;\n}\n</style>\n"],"names":["AButton","defineAsyncComponent","n","nextFormRefs","ref","register","form","props","__props","formModel","isLoading","schema","onMounted","handleClose","Modal","handleOnBeforeSubmit","handleOnAfterSubmit","vMove","el","moveEl","mouseDown","e","elNowPos","mouseBefore","elShape","move","mouseMove","offset","fadeElement","vFadeInOut","binding","config","scaleElement","vScaleIn","rect","offsetX","offsetY","watch","val","checker","_b","_a"],"mappings":"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"}